<!DOCTYPE html>
<html lang="pt-br" class="h-full">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Kyro V18.0 - Magnum Opus Lex</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            lime: {
              700: '#15803d',
              800: '#166534',
              900: '#14532d',
            },
            slate: {
              850: '#1e293b', 
            }
          },
          animation: {
            'slide-in': 'slideIn 0.3s ease-out',
            'fade-out': 'fadeOut 0.3s ease-in forwards',
          },
          keyframes: {
            slideIn: {
              '0%': { transform: 'translateX(100%)', opacity: '0' },
              '100%': { transform: 'translateX(0)', opacity: '1' },
            },
            fadeOut: {
              '0%': { opacity: '1' },
              '100%': { opacity: '0' },
            }
          }
        }
      }
    }
  </script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <style>
    body { font-family: 'Inter', sans-serif; }
    h1, h2, h3 { font-family: 'Playfair Display', serif; }

    /* Estilos de Scrollbar */
    .custom-scrollbar::-webkit-scrollbar { width: 6px; }
    .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
    .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
    .dark .custom-scrollbar::-webkit-scrollbar-thumb { background: #475569; }
    .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #94a3b8; }

    /* Toast Container */
    #toast-container {
        position: fixed;
        top: 1rem;
        right: 1rem;
        z-index: 100;
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
    }

    /* ESTILO A4 JUR√çDICO - FUNDO √öNICO E SEM DIVIS√ïES */
    .legal-doc {
        font-family: 'Times New Roman', Times, serif;
        line-height: 1.5; 
        text-align: justify;
        padding: 3cm 2.5cm 3cm 3cm;
        width: 21cm; 
        min-height: 29.7cm; 
        margin: 0 auto;
        transition: background-color 0.3s ease, color 0.3s ease;
        background-color: white !important;
        color: #000 !important;
        box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
        font-size: 11pt;
    }
    
    .legal-doc * {
        background-color: transparent !important;
    }

    .dark .legal-doc {
        background-color: #1e293b !important;
        color: #f1f5f9 !important;
        box-shadow: 0 0 30px rgba(0, 0, 0, 0.4);
    }

    .legal-header-center {
        text-align: center;
        font-weight: bold;
        text-transform: uppercase;
        margin-bottom: 2cm;
        line-height: 1.2;
        font-family: 'Arial', sans-serif;
        font-size: 10pt;
        border-bottom: 2px solid currentColor;
        padding-bottom: 15px;
    }

    .legal-doc h3 { 
        font-size: 11pt; 
        margin-top: 25px; 
        margin-bottom: 15px; 
        font-weight: bold; 
        text-transform: uppercase;
        font-family: 'Arial', sans-serif;
        text-align: center;
        padding: 5px;
        color: inherit !important;
        border-bottom: 1px solid currentColor;
    }
    
    .legal-doc h4 { 
        font-size: 11pt; 
        margin-top: 20px; 
        margin-bottom: 10px; 
        font-weight: bold; 
        font-style: italic;
        text-decoration: underline;
    }
    
    .legal-doc p {
        margin-bottom: 1em;
        text-indent: 2.5cm;
    }
    
    .legal-doc blockquote {
        margin: 15px 1.5cm 15px 3cm;
        font-size: 9pt;
        text-align: justify;
        font-style: italic;
        border-left: 3px solid currentColor;
        padding-left: 12px;
        opacity: 0.85;
    }
    
    .legal-doc ol {
        margin-left: 2cm;
        margin-bottom: 1em;
    }
    
    .legal-doc li {
        margin-bottom: 0.8em;
        list-style-type: decimal;
    }

    .ementa-box {
        margin: 0 0 1.5cm 7cm;
        font-size: 9pt;
        font-weight: bold;
        text-transform: uppercase;
        text-align: justify;
        line-height: 1.1;
        border-top: 1px solid currentColor;
        border-bottom: 1px solid currentColor;
        padding: 12px 0;
    }

    .dark #output-container {
        background-color: #0f172a; 
    }

    @media print {
      body * { visibility: hidden; }
      #printable-area, #printable-area * { visibility: visible; }
      #printable-area { 
        position: absolute; left: 0; top: 0; width: 100%; 
        background: white !important; color: black !important; padding: 0; margin: 0;
      }
      .no-print { display: none !important; }
      .legal-doc { box-shadow: none; margin: 0; width: 100%; background: white !important; color: black !important; }
      .legal-doc * { background-color: transparent !important; color: black !important; }
    }
  </style>
</head>

<body class="flex flex-col h-screen overflow-hidden text-slate-800 bg-slate-50 dark:bg-slate-900 dark:text-slate-200 transition-colors duration-300">

  <div id="toast-container"></div>

  <!-- HEADER -->
  <header class="bg-white dark:bg-slate-800 border-b border-slate-200 dark:border-slate-700 h-16 flex-shrink-0 z-20 shadow-sm no-print transition-colors relative">
    <div class="container mx-auto px-4 h-full flex items-center justify-between">
      <div class="flex items-center gap-3">
        <div class="bg-lime-800 text-white w-10 h-10 rounded flex items-center justify-center text-lg font-serif font-bold shadow-sm">L</div>
        <div class="leading-tight">
          <h1 class="text-lg text-slate-900 dark:text-white tracking-tight">Kyro Suite <span class="text-xs bg-lime-100 dark:bg-lime-900 dark:text-lime-200 text-lime-800 px-1 rounded ml-1 font-bold">V18.0 MAGNUM</span></h1>
          <p class="text-xs text-slate-500 dark:text-slate-400 font-sans uppercase tracking-wider">PGM Limeira - D√≠vida Ativa</p>
        </div>
      </div>
      
      <div class="flex items-center gap-4">
        <button onclick="toggleHistory()" class="text-slate-500 hover:text-lime-700 dark:text-slate-400 dark:hover:text-lime-400 transition-colors p-2" title="Hist√≥rico"><i class="fa-solid fa-clock-rotate-left text-lg"></i></button>
        <button onclick="toggleTheme()" class="text-slate-500 hover:text-yellow-600 dark:text-slate-400 dark:hover:text-yellow-400 transition-colors p-2"><i class="fa-solid fa-moon dark:hidden text-lg"></i><i class="fa-solid fa-sun hidden dark:inline text-lg"></i></button>
      </div>
    </div>
  </header>

  <div class="flex flex-1 overflow-hidden relative">
    
    <!-- SIDEBAR HIST√ìRICO -->
    <div id="history-sidebar" class="absolute top-0 right-0 h-full w-80 bg-white dark:bg-slate-800 shadow-2xl border-l border-slate-200 dark:border-slate-700 z-40 transform translate-x-full transition-transform duration-300 flex flex-col no-print">
        <div class="p-4 border-b border-slate-200 dark:border-slate-700 flex justify-between items-center bg-slate-50 dark:bg-slate-800">
            <h3 class="font-bold text-slate-700 dark:text-white"><i class="fa-solid fa-clock-rotate-left mr-2"></i> Hist√≥rico</h3>
            <button onclick="toggleHistory()" class="text-slate-400 hover:text-red-500"><i class="fa-solid fa-times"></i></button>
        </div>
        <div id="history-list" class="flex-1 overflow-y-auto p-2 space-y-2 custom-scrollbar"></div>
        <div class="p-3 border-t border-slate-200 dark:border-slate-700">
            <button onclick="clearHistory()" class="w-full py-2 text-xs text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded transition">Limpar Hist√≥rico</button>
        </div>
    </div>

    <!-- √ÅREA DE TRABALHO -->
    <main class="flex-1 flex flex-col lg:flex-row overflow-hidden bg-white dark:bg-slate-900 relative transition-colors">
      
      <!-- COLUNA DA ESQUERDA: INPUT -->
      <section class="flex-1 flex flex-col border-r border-slate-200 dark:border-slate-700 min-w-0 no-print">
        <div class="p-3 bg-slate-50 dark:bg-slate-800 border-b border-slate-200 dark:border-slate-700 flex justify-between items-center">
          <h3 class="font-semibold text-slate-700 dark:text-slate-200 text-sm flex items-center gap-2">
            <i class="fa-solid fa-scale-balanced text-lime-700 dark:text-lime-400"></i> Fatos e Argumentos
          </h3>
          
          <div class="flex items-center gap-2">
              <select onchange="insertTemplate(this.value); this.value=''" class="text-xs border border-slate-300 dark:border-slate-600 rounded px-2 py-1 bg-white dark:bg-slate-700 text-slate-600 dark:text-slate-300 max-w-[150px]">
                <option value="">üìã Selecionar Caso...</option>
                <option value="usucapiao">1. Usucapi√£o (Senten√ßa Retroativa)</option>
                <option value="arrematacao">2. Arremata√ß√£o (Art. 130 CTN)</option>
                <option value="prescricao">3. Prescri√ß√£o Intercorrente</option>
                <option value="ilegitimidade">4. Ilegitimidade Passiva</option>
                <option value="multa">5. Multa Ambiental (Defesa)</option>
              </select>
          </div>
        </div>
        
        <div class="flex-1 p-0 relative group bg-white dark:bg-slate-900">
          <textarea id="input-text" spellcheck="true"
            class="w-full h-full p-6 resize-none focus:outline-none focus:bg-lime-50/20 dark:focus:bg-lime-900/10 transition-colors font-mono text-sm leading-relaxed text-slate-700 dark:text-slate-300 bg-transparent placeholder-slate-400 dark:placeholder-slate-600"
            placeholder="Descreva o caso com detalhes t√©cnicos. O sistema aplicar√° o protocolo Magnum Opus de fundamenta√ß√£o densa."></textarea>
            
            <div class="absolute bottom-2 right-4 text-[10px] text-slate-400 bg-white/80 dark:bg-slate-800/80 px-2 rounded backdrop-blur-sm pointer-events-none">
               <span id="input-counter">0 palavras</span>
            </div>
        </div>

        <!-- BARRA DE A√á√ïES -->
        <div class="p-3 bg-white dark:bg-slate-800 border-t border-slate-200 dark:border-slate-700 shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.05)] z-10">
          <div class="grid grid-cols-2 md:grid-cols-4 gap-2">
            
            <button onclick="routeProcess('correcao')" class="flex items-center justify-center gap-2 p-3 rounded border border-slate-200 dark:border-slate-600 hover:bg-slate-50 dark:hover:bg-slate-700 transition active:scale-95 group">
              <i class="fa-solid fa-spell-check text-blue-600 dark:text-blue-400"></i>
              <span class="text-xs uppercase font-bold text-slate-600 dark:text-slate-400">Revisar</span>
            </button>

            <button onclick="routeProcess('rebuscado')" class="flex items-center justify-center gap-2 p-3 rounded border border-slate-200 dark:border-slate-600 hover:bg-amber-50 dark:hover:bg-slate-700 transition active:scale-95 group">
              <i class="fa-solid fa-scroll text-amber-600 dark:text-amber-500"></i>
              <span class="text-xs uppercase font-bold text-slate-600 dark:text-slate-400">Solenizar</span>
            </button>
            
            <button onclick="routeProcess('tecnico')" class="col-span-2 flex items-center justify-center gap-3 p-3 rounded border border-lime-200 dark:border-lime-900 bg-lime-600 text-white hover:bg-lime-700 transition shadow-md active:scale-95 group" title="Gerar Parecer Jur√≠dico Especializado da PGM">
              <i class="fa-solid fa-gavel"></i>
              <span class="text-xs uppercase font-extrabold tracking-widest">Protocolo Magnum Opus</span>
            </button>

          </div>
        </div>
      </section>

      <!-- COLUNA DA DIREITA: RESULTADO -->
      <section class="flex-1 flex flex-col min-w-0 bg-slate-100 dark:bg-slate-950">
        <div class="p-3 bg-white dark:bg-slate-800 border-b border-slate-200 dark:border-slate-700 flex justify-between items-center shadow-sm no-print">
            <h3 class="font-semibold text-slate-700 dark:text-slate-200 text-sm flex items-center gap-2">
                <i class="fa-solid fa-file-contract text-lime-700 dark:text-lime-500"></i> Sa√≠da Processual
            </h3>
            
            <div class="flex gap-2">
                <button onclick="exportToWord()" class="text-xs flex items-center gap-1 text-blue-700 dark:text-blue-400 border border-blue-200 dark:border-blue-900 bg-blue-50 dark:bg-blue-900/20 px-3 py-1 rounded hover:bg-blue-100 transition">
                    <i class="fa-solid fa-file-word"></i> Word
                </button>
                <button onclick="window.print()" class="text-xs flex items-center gap-1 text-slate-600 dark:text-slate-300 border border-slate-200 dark:border-slate-700 px-3 py-1 rounded hover:bg-slate-50 transition">
                    <i class="fa-solid fa-print"></i> Impress√£o
                </button>
            </div>
        </div>

        <div class="flex-1 p-0 overflow-y-auto custom-scrollbar relative" id="output-container">
          <div id="printable-area" class="hidden">
            <div id="print-content" class="legal-doc"></div>
          </div>

          <div id="placeholder-state" class="h-full flex flex-col items-center justify-center text-slate-400 dark:text-slate-600 opacity-60 no-print">
            <i class="fa-solid fa-landmark text-6xl mb-4 text-lime-700 dark:text-lime-600"></i>
            <p class="text-lg font-medium text-slate-500">Kyro Magnum Opus Lex</p>
            <p class="text-sm mt-2 text-center max-w-sm">Sistema de Reda√ß√£o Institucional de Alta Complexidade.</p>
          </div>

          <div id="loader-state" class="hidden h-full flex flex-col items-center justify-center no-print">
            <div class="w-12 h-12 border-4 border-lime-200 border-t-lime-600 rounded-full animate-spin mb-4"></div>
            <p class="text-sm text-slate-600 dark:text-slate-400 animate-pulse font-bold" id="loader-msg">Compilando Argumenta√ß√£o Jur√≠dica...</p>
          </div>

          <div id="content-state" class="hidden h-full flex flex-col no-print items-center py-8 overflow-auto">
            <div id="output-text" class="legal-doc shadow-2xl outline-none" contenteditable="true"></div>
          </div>
        </div>
      </section>

    </main>
  </div>

  <script>
    let history = JSON.parse(localStorage.getItem('kyro_history_pgm') || '[]');

    function showToast(message, type = 'info') {
        const container = document.getElementById('toast-container');
        const toast = document.createElement('div');
        let bgClass = type === 'success' ? 'bg-lime-600' : type === 'error' ? 'bg-red-600' : 'bg-slate-800';
        toast.className = `${bgClass} text-white px-4 py-3 rounded-lg shadow-lg flex items-center gap-3 text-sm animate-slide-in min-w-[300px] border border-white/10`;
        toast.innerHTML = `<span>${message}</span>`;
        container.appendChild(toast);
        setTimeout(() => toast.remove(), 3000);
    }

    function routeProcess(type) {
        const text = document.getElementById("input-text").value.trim();
        if (!text) { showToast("Insira o substrato f√°tico antes de prosseguir.", "warning"); return; }

        setOutputState('loading', 'Estruturando Parecer de Alta Complexidade...');

        setTimeout(() => { 
            let result = "";
            try {
                if (type === 'tecnico') result = engineMagnumOpus(text); 
                else if (type === 'rebuscado') result = `<h3>REDA√á√ÉO SOLENE</h3><p>${text.toUpperCase()}</p>`;
                else result = `<h3>REVIS√ÉO T√âCNICA</h3><p>${text}</p>`;
                
                if(result) {
                    renderOutput(result);
                    addToHistory(type, text, result);
                    showToast("Documento Consolidado!", "success");
                }
            } catch (e) {
                showToast("Falha na motoriza√ß√£o jur√≠dica.", "error");
                setOutputState('placeholder');
            }
        }, 1800); 
    }

    function engineMagnumOpus(text) {
        const lowerText = text.toLowerCase();
        const date = new Date().toLocaleDateString('pt-BR', {day: 'numeric', month: 'long', year: 'numeric'});
        
        // Matriz de Teses Avan√ßadas
        const theses = [
            {
                key: ["usucapi√£o", "retroativo", "ex tunc"],
                ementa: "TRIBUT√ÅRIO. IPTU. AQUISI√á√ÉO ORIGIN√ÅRIA DA PROPRIEDADE POR USUCAPI√ÉO. NATUREZA DECLARAT√ìRIA DA SENTEN√áA. EFEITOS EX TUNC. CONFLITO ENTRE O DOM√çNIO F√ÅTICO E A PUBLICIDADE REGISTRAL. IMUNIDADE TRIBUT√ÅRIA DE TEMPLOS RELIGIOSOS (ART. 150, VI, 'B' CF). AN√ÅLISE DO FATO GERADOR.",
                fundamentacao: `
                <h4>A. Da Natureza Declarat√≥ria e os Efeitos Retroativos</h4>
                <p>O instituto da usucapi√£o, como modo origin√°rio de aquisi√ß√£o da propriedade, opera mediante senten√ßa judicial de natureza eminentemente declarat√≥ria. Doutrina e jurisprud√™ncia p√°trias (REsp 1.187.337/SP) convergem no sentido de que o reconhecimento do dom√≠nio retroage √† data em que se completou o lapso temporal da posse <em>ad usucapionem</em>, operando efeitos <em>ex tunc</em>.</p>
                <p>Nesse diapas√£o, a titularidade tribut√°ria (Art. 32 do CTN) deve ser reavaliada √† luz da realidade f√°tica declarada judicialmente. Se o requerente j√° detinha o <em>animus domini</em> e exercia a posse qualificada durante os exerc√≠cios lan√ßados, a responsabilidade tribut√°ria do antigo propriet√°rio tabular torna-se juridicamente question√°vel em face da aquisi√ß√£o origin√°ria.</p>
                <h4>B. Da Imunidade Constitucional e o Destino do Im√≥vel</h4>
                <p>Sendo o requerente entidade religiosa, a imunidade prevista no Art. 150, VI, 'b' da Carta Magna goza de presun√ß√£o de finalidade institucional, conforme entendimento do STF (RE 325.822/SP). A retroatividade da senten√ßa de usucapi√£o, portanto, tem o cond√£o de anular os lan√ßamentos de IPTU desde o momento da consuma√ß√£o da prescri√ß√£o aquisitiva, desde que comprovada a afeta√ß√£o do bem aos cultos.</p>`
            },
            {
                key: ["arremata√ß√£o", "leil√£o", "art. 130"],
                ementa: "EXECU√á√ÉO FISCAL. ARREMATA√á√ÉO EM HASTA P√öBLICA. AQUISI√á√ÉO ORIGIN√ÅRIA. SUB-ROGA√á√ÉO DOS D√âBITOS NO PRE√áO (ART. 130, PAR√ÅGRAFO √öNICO, CTN). PROTE√á√ÉO AO TERCEIRO ARREMATANTE DE BOA-F√â. SEGURAN√áA JUR√çDICA.",
                fundamentacao: `
                <h4>A. Da Sub-roga√ß√£o Real pelo Pre√ßo</h4>
                <p>A arremata√ß√£o judicial constitui modo origin√°rio de aquisi√ß√£o da propriedade, rompendo-se o liame obrigacional entre o antigo devedor e o bem. O Art. 130, par√°grafo √∫nico do CTN estabelece norma de efic√°cia plena: os cr√©ditos tribut√°rios sub-rogam-se no pre√ßo da arremata√ß√£o. Trata-se de fic√ß√£o jur√≠dica que visa garantir a atratividade das hastas p√∫blicas e a seguran√ßa jur√≠dica do sistema de execu√ß√µes.</p>
                <p>Precedentes vinculantes do Superior Tribunal de Justi√ßa (REsp 1.059.100/RS) asseveram que o arrematante n√£o responde por d√©bitos anteriores √† aliena√ß√£o judicial que n√£o constassem expressamente do edital. A transfer√™ncia deve ocorrer livre de quaisquer √¥nus fiscais, devendo a Fazenda P√∫blica buscar a satisfa√ß√£o do seu cr√©dito no produto da arrecada√ß√£o ou em face do executado original.</p>`
            },
            {
                key: ["prescri√ß√£o", "intercorrente", "5 anos", "art. 40"],
                ementa: "PROCESSO CIVIL E TRIBUT√ÅRIO. EXECU√á√ÉO FISCAL. PRESCRI√á√ÉO INTERCORRENTE. SISTEM√ÅTICA DO ART. 40 DA LEF. TEMA 566 STJ. IN√âRCIA DA EXEQUENTE POR PRAZO SUPERIOR AO QUINQU√äNIO LEGAL.",
                fundamentacao: `
                <h4>A. Dos Crit√©rios de Flu√™ncia da Prescri√ß√£o</h4>
                <p>A sistem√°tica da prescri√ß√£o intercorrente nas execu√ß√µes fiscais foi pacificada pelo C. STJ no REsp 1.340.553/RS (Repetitivo). O termo inicial da contagem do prazo prescricional quinquenal √© autom√°tico e ocorre ap√≥s o transcurso de 1 (um ano) da suspens√£o do feito por n√£o localiza√ß√£o do devedor ou de bens.</p>
                <p>No caso em tela, verifica-se que a pretens√£o executiva estatal quedou-se inerte por per√≠odo superior ao lapso de 5 (cinco) anos ap√≥s o per√≠odo de suspens√£o. A aus√™ncia de dilig√™ncias √∫teis por parte da exequente atrai a incid√™ncia do Art. 156, V do CTN, operando-se a extin√ß√£o definitiva do cr√©dito tribut√°rio pela via da prescri√ß√£o, restando invi√°vel a manuten√ß√£o do nome do contribuinte no cadastro de inadimplentes.</p>`
            }
        ];

        let selectedThesis = theses.find(t => t.key.some(k => lowerText.includes(k)));
        
        if (!selectedThesis) {
            selectedThesis = {
                ementa: "ADMINISTRATIVO E TRIBUT√ÅRIO. REVIS√ÉO DE LAN√áAMENTO EM D√çVIDA ATIVA. PRESUN√á√ÉO DE CERTEZA E LIQUIDEZ DA CDA. ART. 3¬∫ DA LEI 6.830/80. PRINC√çPIO DA LEGALIDADE ESTRITA.",
                fundamentacao: `
                <h4>A. Da Presun√ß√£o de Legitimidade da CDA</h4>
                <p>A Certid√£o de D√≠vida Ativa (CDA) √© t√≠tulo executivo administrativo que goza de presun√ß√£o juris tantum de certeza, liquidez e exigibilidade, conforme o Art. 204 do CTN. Tal presun√ß√£o s√≥ pode ser ilidida por prova inequ√≠voca a cargo do contribuinte ou de terceiro interessado.</p>
                <p>A an√°lise administrativa limita-se √† verifica√ß√£o de v√≠cios formais ou erros materiais no lan√ßamento. Argumentos de ordem f√°tica desprovidos de lastro documental robusto n√£o possuem o cond√£o de suspender ou extinguir o cr√©dito tribut√°rio, sob pena de responsabilidade funcional do agente p√∫blico em face da indisponibilidade do interesse p√∫blico e do patrim√¥nio municipal.</p>`
            };
        }

        return `
            <div class="legal-header-center">
                PREFEITURA MUNICIPAL DE LIMEIRA<br>
                PROCURADORIA GERAL DO MUNIC√çPIO<br>
                DIVIS√ÉO DE GEST√ÉO DA D√çVIDA ATIVA E EXECU√á√ÉO FISCAL
            </div>
            
            <h3 style="border: none;">PARECER T√âCNICO-JUR√çDICO N¬∫ ${Math.floor(Math.random() * 5000)}/2025-PGM/DA</h3>
            
            <p style="text-indent: 0;"><strong>EXPEDIENTE:</strong> [Protocolo Externo/SIF]<br>
            <strong>ASSUNTO:</strong> Pedido de Revis√£o de Inscri√ß√£o em D√≠vida Ativa.<br>
            <strong>INTERESSADO:</strong> [Identificado no contexto dos fatos].</p>

            <div class="ementa-box">
                <p style="text-indent: 0; margin: 0;"><strong>EMENTA:</strong> ${selectedThesis.ementa}</p>
            </div>

            <h3>I. RELAT√ìRIO CIRCUNSTANCIADO</h3>
            <p>Vieram os autos a esta Assist√™ncia Jur√≠dica ap√≥s tramita√ß√£o pelos √≥rg√£os de arrecada√ß√£o e fiscaliza√ß√£o imobili√°ria. Trata-se de requerimento fundamentado no qual a parte interessada insurge-se contra os lan√ßamentos tribut√°rios inscritos sob a √©gide da D√≠vida Ativa Municipal.</p>
            <p>O cerne do inconformismo reside na seguinte tese f√°tica, ora colacionada <em>ipsis litteris</em>:</p>
            <blockquote>"${text}"</blockquote>
            <p>√â o breve e necess√°rio relat√≥rio. Passa-se ao exame de admissibilidade e m√©rito.</p>

            <h3>II. JU√çZO DE ADMISSIBILIDADE E PRELIMINARES</h3>
            <p>Compulsando os autos, verifica-se que o requerimento √© tempestivo e foi subscrito por parte leg√≠tima, apresentando os documentos essenciais √† identifica√ß√£o do im√≥vel (Inscri√ß√£o Cadastral) e do sujeito passivo. N√£o se verificam nulidades processuais administrativas que impe√ßam a an√°lise merit√≥ria da pretens√£o.</p>

            <h3>III. FUNDAMENTA√á√ÉO JUR√çDICA E AN√ÅLISE DO CASO</h3>
            ${selectedThesis.fundamentacao}
            
            <h4>C. Da An√°lise Probat√≥ria e Documental</h4>
            <p>Conforme o regramento do C√≥digo Tribut√°rio Municipal de Limeira, a altera√ß√£o de dados cadastrais retroativa exige a apresenta√ß√£o de t√≠tulo translativo de dom√≠nio ou senten√ßa judicial com tr√¢nsito em julgado. No caso em tela, a an√°lise t√©cnica dos documentos acostados sugere a conformidade com as teses acima expostas, demandando a atua√ß√£o imediata da Administra√ß√£o para evitar o prosseguimento de execu√ß√µes fiscais indevidas.</p>

            <h3>IV. CONCLUS√ÉO E VOTO DO RELATOR</h3>
            <p>Diante de todo o exposto, em estrita observ√¢ncia ao princ√≠pio da moralidade administrativa e da efici√™ncia, esta Coordenadoria de D√≠vida Ativa manifesta-se pelo <strong>ENCAMINHAMENTO</strong> dos autos √† Secretaria de Finan√ßas para a imediata:</p>
            <ol>
                <li>Retifica√ß√£o do Cadastro Imobili√°rio conforme a nova realidade jur√≠dica declarada;</li>
                <li>Baixa das inscri√ß√µes em D√≠vida Ativa cujos fatos geradores foram alcan√ßados pela fundamenta√ß√£o aqui exposta;</li>
                <li>Peticionamento judicial, se necess√°rio, para informar a extin√ß√£o do d√©bito nas execu√ß√µes fiscais em curso.</li>
            </ol>
            
            <p>√â o parecer que submeto √† homologa√ß√£o superior.</p>

            <br><br>
            <p style="text-align: right;">Limeira, ${date}.</p>
            
            <br>
            <div style="text-align: center;">
                __________________________________________<br>
                <strong>PROCURADORIA GERAL DO MUNIC√çPIO</strong><br>
                Assistente Jur√≠dico Oficial - D√≠vida Ativa
            </div>
        `;
    }

    function renderOutput(html) { 
        document.getElementById('output-text').innerHTML = html; 
        document.getElementById('print-content').innerHTML = html; 
        setOutputState('content'); 
    }

    function setOutputState(state, msg) {
        document.getElementById('placeholder-state').classList.add('hidden');
        document.getElementById('loader-state').classList.add('hidden');
        document.getElementById('content-state').classList.add('hidden');
        if (state === 'loading') { 
            document.getElementById('loader-state').classList.remove('hidden'); 
            document.getElementById('loader-msg').innerText = msg; 
        }
        else if (state === 'content') document.getElementById('content-state').classList.remove('hidden');
        else document.getElementById('placeholder-state').classList.remove('hidden');
    }

    function addToHistory(type, input, output) {
        history.unshift({id: Date.now(), date: new Date().toLocaleTimeString(), type, inputSnippet: input.substring(0,40), output});
        if (history.length > 15) history.pop();
        localStorage.setItem('kyro_history_pgm', JSON.stringify(history));
    }

    function renderHistory() {
        const list = document.getElementById('history-list'); list.innerHTML = '';
        if (history.length === 0) list.innerHTML = '<div class="text-center text-slate-400 text-xs mt-10">Hist√≥rico de pareceres vazio.</div>';
        history.forEach(item => {
            const el = document.createElement('div');
            el.className = "bg-white dark:bg-slate-700 p-2 rounded border border-slate-200 dark:border-slate-600 text-xs hover:border-lime-500 cursor-pointer mb-2 transition";
            el.onclick = () => { renderOutput(item.output); toggleHistory(); };
            el.innerHTML = `<b>${item.type.toUpperCase()}</b> - ${item.date}<br><span class="opacity-60">"${item.inputSnippet}..."</span>`;
            list.appendChild(el);
        });
    }

    function clearHistory() { history = []; localStorage.removeItem('kyro_history_pgm'); renderHistory(); }
    function toggleHistory() { document.getElementById('history-sidebar').classList.toggle('translate-x-full'); renderHistory(); }
    function toggleTheme() { document.documentElement.classList.toggle('dark'); }
    
    function insertTemplate(v) {
        const templates = {
            'usucapiao': 'Requerimento de baixa de IPTU. Entidade religiosa comprovou posse ad usucapionem com senten√ßa transitada em julgado reconhecendo dom√≠nio desde 2012. Alega imunidade tribut√°ria retroativa.',
            'arrematacao': 'Arremata√ß√£o judicial de im√≥vel em leil√£o da 3¬™ Vara C√≠vel de Limeira. O edital silenciou sobre d√©bitos de IPTU pret√©ritos. Requer a sub-roga√ß√£o no pre√ßo conforme Art. 130 do CTN.',
            'prescricao': 'Execu√ß√£o fiscal referente a d√©bitos de 2015. Processo suspenso em 2017 e sem nova movimenta√ß√£o √∫til da Fazenda at√© a data presente. Requer reconhecimento de prescri√ß√£o intercorrente.',
            'ilegitimidade': 'Cobran√ßa de multa de terreno. Contribuinte apresenta Escritura de Venda e Compra datada de 2018 com registro posterior. Alega aus√™ncia de nexo causal no momento da infra√ß√£o.',
            'multa': 'Defesa contra multa ambiental por falta de ro√ßada. Requerente alega que o im√≥vel foi invadido e que h√° processo de reintegra√ß√£o de posse em curso, impossibilitando a manuten√ß√£o.'
        };
        if(v) document.getElementById('input-text').value = templates[v];
    }

    function updateCounters() { 
        const c = document.getElementById('input-text').value.trim().split(/\s+/).filter(w=>w).length; 
        document.getElementById('input-counter').innerText = c + ' palavras'; 
    }

    document.getElementById('input-text').addEventListener('input', updateCounters);

    function exportToWord() { 
        const content = document.getElementById('output-text').innerText;
        const blob = new Blob(['\ufeff', content], {type: 'application/msword'});
        const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = 'Parecer_MagnumOpus.doc'; a.click(); 
    }

    if (localStorage.getItem('kyro_theme') === 'dark') document.documentElement.classList.add('dark');
  </script>
</body>
</html>